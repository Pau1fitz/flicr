var app=angular.module("potatoApp",["ngRoute"]);app.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"app/views/home.html",controller:"potatoCtrl as ctrl"}).when("/:id",{templateUrl:"app/views/post.html",controller:"potatoCtrl as ctrl"}).otherwise({redirectTo:"/"})}),app.factory("getFlickrData",function($http){return{data:{},getData:function(){return $http.jsonp("https://api.flickr.com/services/feeds/photos_public.gne?tags=potato&tagmode=alll&format=json&jsoncallback=JSON_CALLBACK")}}}),app.filter("regex",function(){return function(val){var regExp=/\(([^)]+)\)/,match=regExp.exec(val);return null!==match?match[1]:void 0}}),app.filter("truncate",function(){return function(text,end){var length=35,end="...",check=text.length<=length||text.length-end.length<=length,cut=String(text).substring(0,length-end.length)+end;return check?text:cut}}),app.controller("potatoCtrl",["getFlickrData","$routeParams","$window","regexFilter","truncateFilter",function(getFlickrData,$routeParams,$window,regexFilter,truncateFilter){var potatoCtrl=this;this.posts=[],this.tags,this.currentId=$routeParams.id,this.loading=!0,this.limit=5,this.morePosts=!0,getFlickrData.getData().success(function(data){for(var x=data.items.length,i=0;x>i;i++)potatoCtrl.posts.push(data.items[i]);potatoCtrl.posts=_.uniqBy(potatoCtrl.posts,"tags"),potatoCtrl.tags=_.values(_.mapValues(potatoCtrl.posts,function(o){return o.tags.split(" ")})),potatoCtrl.loading=!1}).error(function(){potatoCtrl.loading=!1,potatoCtrl.error=!0}),this.loadMore=function(){potatoCtrl.limit+=3,potatoCtrl.limit>=potatoCtrl.posts.length&&(potatoCtrl.morePosts=!1)},$window.gapi.plusone.go("content")}]);